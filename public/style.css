// Initialize Particles.js
document.addEventListener('DOMContentLoaded', function() {
    // Particles.js configuration
    if (typeof particlesJS !== 'undefined') {
        particlesJS('particles-js', {
            particles: {
                number: {
                    value: 80,
                    density: {
                        enable: true,
                        value_area: 800
                    }
                },
                color: {
                    value: ["#ff1493", "#00ffaa", "#ff8c00"]
                },
                shape: {
                    type: "circle"
                },
                opacity: {
                    value: 0.5,
                    random: true
                },
                size: {
                    value: 3,
                    random: true
                },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#ff1493",
                    opacity: 0.2,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: "none",
                    random: true,
                    straight: false,
                    out_mode: "out",
                    bounce: false
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: {
                        enable: true,
                        mode: "repulse"
                    },
                    onclick: {
                        enable: true,
                        mode: "push"
                    }
                }
            }
        });
    }

    // Get current URL for loadstring
    const currentUrl = window.location.origin;
    const loadstringUrl = `${currentUrl}/script`;
    const loadstringCode = `loadstring(game:HttpGet("${loadstringUrl}"))()`;
    
    // Update loadstring display
    document.getElementById('loadstringUrl').textContent = loadstringUrl;
    
    // Copy functionality
    window.copyToClipboard = function() {
        navigator.clipboard.writeText(loadstringCode)
            .then(() => {
                const status = document.getElementById('copyStatus');
                status.textContent = '✓ Copied!';
                status.style.color = '#00ffaa';
                
                setTimeout(() => {
                    status.textContent = '';
                }, 3000);
            })
            .catch(err => {
                console.error('Failed to copy: ', err);
                const status = document.getElementById('copyStatus');
                status.textContent = '✗ Failed to copy';
                status.style.color = '#ff4444';
            });
    };
    
    // Button event listeners
    document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
    document.getElementById('copyLoadstring').addEventListener('click', copyToClipboard);
    
    // Execute button
    document.getElementById('executeBtn').addEventListener('click', function() {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        `;
        
        modal.innerHTML = `
            <div style="
                background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
                padding: 40px;
                border-radius: 20px;
                border: 2px solid rgba(255, 20, 147, 0.3);
                max-width: 500px;
                width: 90%;
                text-align: center;
            ">
                <h2 style="color: #ff1493; margin-bottom: 20px;">Script Execution</h2>
                <p style="color: #ccc; margin-bottom: 30px;">
                    Copy the following loadstring and paste it into your executor:
                </p>
                <div style="
                    background: rgba(0, 0, 0, 0.5);
                    padding: 20px;
                    border-radius: 10px;
                    border: 1px solid rgba(255, 20, 147, 0.3);
                    margin-bottom: 30px;
                    font-family: monospace;
                    color: #00ffaa;
                    word-break: break-all;
                ">
                    ${loadstringCode}
                </div>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button id="modalCopyBtn" style="
                        background: linear-gradient(135deg, #ff1493, #ff8c00);
                        color: white;
                        border: none;
                        padding: 12px 25px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: 600;
                    ">
                        Copy Loadstring
                    </button>
                    <button id="modalCloseBtn" style="
                        background: transparent;
                        color: #ccc;
                        border: 2px solid #ff1493;
                        padding: 12px 25px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: 600;
                    ">
                        Close
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.querySelector('#modalCopyBtn').addEventListener('click', copyToClipboard);
        modal.querySelector('#modalCloseBtn').addEventListener('click', () => {
            document.body.removeChild(modal);
        });
    });
    
    // FAQ accordion
    const faqItems = document.querySelectorAll('.faq-item');
    faqItems.forEach(item => {
        const question = item.querySelector('.faq-question');
        question.addEventListener('click', () => {
            item.classList.toggle('active');
        });
    });
    
    // Mobile menu toggle
    const mobileToggle = document.querySelector('.mobile-toggle');
    const nav = document.querySelector('.nav');
    
    if (mobileToggle && nav) {
        mobileToggle.addEventListener('click', () => {
            nav.style.display = nav.style.display === 'flex' ? 'none' : 'flex';
            if (nav.style.display === 'flex') {
                nav.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    position: absolute;
                    top: 100%;
                    right: 20px;
                    background: rgba(10, 10, 20, 0.95);
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(255, 20, 147, 0.3);
                    border-radius: 10px;
                    padding: 20px;
                    z-index: 1000;
                    gap: 15px;
                `;
            }
        });
    }
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;
            
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                window.scrollTo({
                    top: targetElement.offsetTop - 100,
                    behavior: 'smooth'
                });
                
                // Close mobile menu if open
                if (window.innerWidth <= 768 && nav) {
                    nav.style.display = 'none';
                }
            }
        });
    });
    
    // Add typing animation to hero title
    const heroTitle = document.querySelector('.hero-title');
    if (heroTitle) {
        const text = heroTitle.innerHTML;
        heroTitle.innerHTML = '';
        
        let i = 0;
        const typeWriter = () => {
            if (i < text.length) {
                heroTitle.innerHTML += text.charAt(i);
                i++;
                setTimeout(typeWriter, 50);
            }
        };
        
        // Start typing after 1 second
        setTimeout(typeWriter, 1000);
    }
    
    // Add scroll animation to feature cards
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe feature cards and steps
    document.querySelectorAll('.feature-card, .step').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });
});
